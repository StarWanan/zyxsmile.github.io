{"title":"Pytorch & python","uid":"4346091fabb18c4f718acfd51c087897","slug":"python&pytorchä½¿ç”¨æŒ‡å—","date":"2022-05-03T12:10:00.000Z","updated":"2022-05-04T03:39:30.478Z","comments":true,"path":"api/articles/python&pytorchä½¿ç”¨æŒ‡å—.json","keywords":null,"cover":null,"content":"<h1 id=\"pytorch\">pytorch</h1>\n<h2 id=\"å‚æ•°-å‘½ä»¤è¡Œ-è¾…åŠ©\">å‚æ•° &amp; å‘½ä»¤è¡Œ &amp; è¾…åŠ©</h2>\n<h3 id=\"logger\">logger</h3>\n<p><a\nhref=\"https://blog.csdn.net/liming89/article/details/109609557\">loggeræ¨¡å—è§£é‡Š\nâ€”â€” CSDN</a> <a\nhref=\"https://vimsky.com/examples/detail/python-method-utils.logger.setup_logger.html\">loggerä½¿ç”¨æ¡ˆä¾‹</a></p>\n<p>loggingæ¨¡å—æ˜¯Pythonå†…ç½®çš„æ ‡å‡†æ¨¡å—ï¼Œä¸»è¦ç”¨äºè¾“å‡ºè¿è¡Œæ—¥å¿—ï¼Œå¯ä»¥è®¾ç½®è¾“å‡ºæ—¥å¿—çš„ç­‰çº§ã€æ—¥å¿—ä¿å­˜è·¯å¾„ã€æ—¥å¿—æ–‡ä»¶å›æ»šç­‰</p>\n<h3 id=\"yacs.config\">yacs.config</h3>\n<p><a href=\"https://zhuanlan.zhihu.com/p/366289700\">yacsä½¿ç”¨ â€”â€”\nçŸ¥ä¹</a></p>\n<p>yacsåº“ï¼Œç”¨äºä¸ºä¸€ä¸ªç³»ç»Ÿæ„å»ºconfigæ–‡ä»¶</p>\n<p>éœ€è¦åˆ›å»º<code>CN()</code>è¿™ä¸ªä½œä¸ºå®¹å™¨æ¥è£…è½½æˆ‘ä»¬çš„å‚æ•°ï¼Œè¿™ä¸ªå®¹å™¨å¯ä»¥åµŒå¥—</p>\n<h2 id=\"è®¾å¤‡ç›¸å…³\">è®¾å¤‡ç›¸å…³</h2>\n<h3 id=\"torch.cuda.synchronize\">torch.cuda.synchronize()</h3>\n<p>ç­‰å¾…å½“å‰è®¾å¤‡ä¸Šæ‰€æœ‰æµä¸­çš„æ‰€æœ‰æ ¸å¿ƒå®Œæˆã€‚</p>\n<p>ğŸŒ°ï¼šæµ‹è¯•æ—¶é—´çš„ä»£ç </p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token comment\"># code 1</span>\nstart <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nresult <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">)</span>\nend <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># code 2</span>\ntorch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>synchronize<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nstart <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nresult <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">)</span>\ntorch<span class=\"token punctuation\">.</span>cuda<span class=\"token punctuation\">.</span>synchronize<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nend <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># code 3</span>\nstart <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nresult <span class=\"token operator\">=</span> model<span class=\"token punctuation\">(</span><span class=\"token builtin\">input</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\nend <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>ä»£ç 2æ˜¯æ­£ç¡®çš„ã€‚å› ä¸ºåœ¨pytorché‡Œé¢ï¼Œç¨‹åºçš„æ‰§è¡Œéƒ½æ˜¯å¼‚æ­¥çš„ã€‚\nå¦‚æœé‡‡ç”¨ä»£ç 1ï¼Œæµ‹è¯•çš„æ—¶é—´ä¼šå¾ˆçŸ­ï¼Œå› ä¸ºæ‰§è¡Œå®Œend=time.time()ç¨‹åºå°±é€€å‡ºäº†ï¼Œåå°çš„cuä¹Ÿå› ä¸ºpythonçš„é€€å‡ºé€€å‡ºäº†ã€‚\nå¦‚æœé‡‡ç”¨ä»£ç 2ï¼Œä»£ç ä¼šåŒæ­¥cuçš„æ“ä½œï¼Œç­‰å¾…gpuä¸Šçš„æ“ä½œéƒ½å®Œæˆäº†å†ç»§ç»­æˆå½¢end\n= time.time()</p>\n<p>ä»£ç 3å’Œä»£ç 2çš„æ—¶é—´æ˜¯ç±»ä¼¼çš„ã€‚\nå› ä¸ºä»£ç 3ä¼šç­‰å¾…gpuä¸Šçš„ç»“æœæ‰§è¡Œå®Œä¼ ç»™printå‡½æ•°ï¼Œæ‰€ä»¥æ—¶é—´å°±å’Œä»£ç 2åŒæ­¥çš„æ“ä½œçš„æ—¶é—´åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„äº†ã€‚\nå°†print(result)æ¢æˆresult.cpu()ç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p>\n<h2 id=\"æ•°æ®åŠ è½½\">æ•°æ®åŠ è½½</h2>\n<h2 id=\"å›¾åƒæ•°æ®å˜æ¢\">å›¾åƒæ•°æ®å˜æ¢</h2>\n<p>transforms.Normalize([0.485, 0.456, 0.406], [0.229, 0.224,\n0.225])</p>\n<p>Normalizeæ˜¯æŠŠå›¾åƒæ•°æ®ä»[0,1]å˜æˆ[-1,1]ï¼Œå˜æ¢å…¬å¼æ˜¯image=(image-mean)/stdï¼Œé‚£ä¹ˆå…¶ä¸­çš„å‚æ•°å°±åˆ†åˆ«æ˜¯ä¸‰ä¸ªé€šé“çš„meanå’Œstdï¼Œè¿™ä¸ªå‡å€¼å’Œæ ‡å‡†å·®éœ€è¦è‡ªå·±è®¡ç®—ï¼ŒèŒƒå›´å°±æ˜¯è®­ç»ƒé›†å’ŒéªŒè¯é›†çš„æ‰€æœ‰å›¾åƒã€‚</p>\n<h3 id=\"dataloader\">DataLoader</h3>\n<p><a\nhref=\"https://blog.csdn.net/weixin_42468475/article/details/108714940\">CSDNåŸæ–‡é“¾æ¥</a>\n<a href=\"https://zhuanlan.zhihu.com/p/361830892\">collate_fnå‚æ•°ä½¿ç”¨è¯¦è§£\nâ€”â€” çŸ¥ä¹</a> <a\nhref=\"https://blog.csdn.net/qq_24407657/article/details/103992170\">num_workså‚æ•°\nâ€”â€” CSDN</a></p>\n<hr />\n<p>åŠ è½½ä¸€ä¸ªbatchçš„æ•°æ®è¿™ä¸€æ­¥éœ€è¦ä½¿ç”¨ä¸€ä¸ª<code>torch.utils.data.DataLoader</code>å¯¹è±¡ï¼Œå¹¶ä¸”DataLoaderæ˜¯ä¸€ä¸ªåŸºäºæŸä¸ªdatasetçš„iterableï¼Œè¿™ä¸ªiterableæ¯æ¬¡ä»datasetä¸­åŸºäºæŸç§é‡‡æ ·åŸåˆ™å–å‡ºä¸€ä¸ªbatchçš„æ•°æ®ã€‚\nä¹Ÿå¯ä»¥è¿™æ ·è¯´ï¼šTorchä¸­å¯ä»¥åˆ›å»ºä¸€ä¸ªtorch.utils.data.==Dataset==å¯¹è±¡ï¼Œå¹¶ä¸torch.utils.data.==DataLoader==ä¸€èµ·ä½¿ç”¨ï¼Œåœ¨è®­ç»ƒæ¨¡å‹æ—¶ä¸æ–­ä¸ºæ¨¡å‹æä¾›æ•°æ®ã€‚</p>\n<p><strong>torch.utils.data.DataLoader</strong></p>\n<p>å®šä¹‰ï¼šData loader. Combines a dataset and a sampler, and provides an\niterable over the given dataset. æ„é€ å‡½æ•°: <pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>DataLoader<span class=\"token punctuation\">(</span>dataset<span class=\"token punctuation\">,</span> \n\t\t\t\t\t\t\tbatch_size<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> \n\t\t\t\t\t\t\tshuffle<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> \n\t\t\t\t\t\t\tsampler<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t\t\tbatch_sampler<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span> num_workers<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> collate_fn<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t\t\tpin_memory<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> drop_last<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> timeout<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\t\t\t\t\t\t\tworker_init_fn<span class=\"token operator\">=</span><span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> - dataset:\næŠ½è±¡ç±»,åŒ…å«ä¸¤ç§ç±»å‹ - <code>map-style datasets</code> -\n<code>iterable-style datasets</code> - batch_size :\næ¯ä¸€æ¬¡æŠ½æ ·çš„batch-sizeå¤§å° - shuffle : Trueåˆ™éšæœºæ‰“ä¹±æ•°æ® -\nNum_worksï¼šå°†batchåŠ è½½è¿›RAMçš„è¿›ç¨‹æ•°ã€‚å†…å­˜å¼€é”€å¤§ï¼ŒCPUè´Ÿæ‹…å¤§ã€‚å¯èƒ½ä¹‹åå‡ æ¬¡è¿­ä»£çš„æ•°æ®åœ¨æœ¬æ¬¡è¿­ä»£çš„æ—¶å€™å·²ç»åŠ è½½è¿›å†…å­˜ã€‚\n-\ncollate_fnï¼šå¦‚ä½•å–æ ·æœ¬çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå·±çš„å‡½æ•°æ¥å‡†ç¡®åœ°å®ç°æƒ³è¦çš„åŠŸèƒ½ã€‚\n-\ndrop_lastï¼šå‘Šè¯‰å¦‚ä½•å¤„ç†æ•°æ®é›†é•¿åº¦é™¤äºbatch_sizeä½™ä¸‹çš„æ•°æ®ã€‚Trueå°±æŠ›å¼ƒï¼Œå¦åˆ™ä¿ç•™ã€‚</p>\n<p><strong>Map-style datasets</strong></p>\n<p>æ˜¯ä¸€ä¸ªç±»ï¼Œè¦æ±‚æœ‰\n<code>__getitem__()</code>and<code>__len__()</code>è¿™ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œä»£è¡¨ä¸€ä¸ªä»ç´¢å¼•æ˜ å°„åˆ°æ•°æ®æ ·æœ¬ã€‚\n- <code>__getitem__()</code>: æ ¹æ®ç´¢å¼•indexéå†æ•°æ® -\n<code>__len__()</code>: è¿”å›æ•°æ®é›†çš„é•¿åº¦ - å¯ç¼–å†™ç‹¬ç«‹çš„æ•°æ®å¤„ç†å‡½æ•° - åœ¨\n<code>__getitem()__</code> å‡½æ•°ä¸­è¿›è¡Œè°ƒç”¨ - ç›´æ¥å°†æ•°æ®å¤„ç†å‡½æ•°å†™åœ¨\n<code>__getitem()__</code> æˆ–è€… <code>__init()__</code>\nå‡½æ•°ä¸­ï¼Œä½†æ˜¯<code>__getitem()__</code>\nå¿…é¡»æ ¹æ®==index==è¿”å›å“åº”çš„å€¼ï¼Œè¯¥å€¼ä¼šé€šè¿‡indexä¼ åˆ°dataloaderä¸­è¿›è¡Œåç»­çš„batchæ‰¹å¤„ç†ã€‚</p>\n<p>åŸºæœ¬éœ€è¦æ»¡è¶³ï¼š <pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">__getitem__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>trg<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">__len__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">)</span>  <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>\n<p><code>getitem()</code>æ–¹æ³•ç”¨æ¥ä»datasetsä¸­è¯»å–ä¸€æ¡æ•°æ®ï¼Œè¿™æ¡æ•°æ®åŒ…å«è®­ç»ƒ<strong>å›¾ç‰‡</strong>ï¼ˆå·²CVè·ç¦»ï¼‰å’Œ<strong>æ ‡ç­¾</strong>ï¼Œå‚æ•°indexè¡¨ç¤ºå›¾ç‰‡å’Œæ ‡ç­¾åœ¨æ€»æ•°æ®é›†ä¸­çš„Indexã€‚</p>\n<p><code>len()</code>æ–¹æ³•è¿”å›æ•°æ®é›†çš„æ€»é•¿åº¦ï¼ˆè®­ç»ƒé›†çš„æ€»æ•°ï¼‰ã€‚</p>\n<p><strong>å®ç° MyDatasets ç±»</strong></p>\n<ol type=\"1\">\n<li>ç®€å•ç›´ç™½</li>\n</ol>\n<p>æŠŠ x å’Œ label åˆ†åˆ«è£…å…¥ä¸¤ä¸ªåˆ—è¡¨ self.src å’Œ self.trg ï¼Œç„¶åé€šè¿‡\ngetitem(self, idex) è¿”å›å¯¹åº”å…ƒç´  <pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> torch\n<span class=\"token keyword\">from</span> torch <span class=\"token keyword\">import</span> nn\n<span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">import</span> Dataset<span class=\"token punctuation\">,</span> DataLoader\n \n<span class=\"token keyword\">class</span> <span class=\"token class-name\">My_dataset</span><span class=\"token punctuation\">(</span>Dataset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token builtin\">super</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>__init__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">## ä½¿ç”¨sinå‡½æ•°è¿”å›10000ä¸ªæ—¶é—´åºåˆ—,å¦‚æœä¸è‡ªå·±æ„é€ æ•°æ®ï¼Œå°±ä½¿ç”¨numpy,pandasç­‰è¯»å–è‡ªå·±çš„æ•°æ®ä¸ºxå³å¯ã€‚</span>\n        <span class=\"token comment\">## ä»¥ä¸‹æ•°æ®ç»„ç»‡è¿™å—æ—¢å¯ä»¥æ”¾åœ¨initæ–¹æ³•é‡Œï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨getitemæ–¹æ³•é‡Œ</span>\n        self<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>randn<span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">.</span><span class=\"token builtin\">sum</span><span class=\"token punctuation\">(</span>axis<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">,</span>  self<span class=\"token punctuation\">.</span>trg <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            self<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>x<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n            self<span class=\"token punctuation\">.</span>trg<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>y<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    \n           \n    <span class=\"token keyword\">def</span> <span class=\"token function\">__getitem__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> self<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> self<span class=\"token punctuation\">.</span>trg<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__len__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">)</span> \n        \n <span class=\"token comment\">## æˆ–è€…return len(self.trg), srcå’Œtrgé•¿åº¦ä¸€æ ·</span>\n \ndata_train <span class=\"token operator\">=</span> My_dataset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ndata_test <span class=\"token operator\">=</span> My_dataset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\ndata_loader_train <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>data_train<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\ndata_loader_test <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>data_test<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">## i_batchçš„å¤šå°‘æ ¹æ®batch sizeå’Œdef __len__(self)è¿”å›çš„é•¿åº¦ç¡®å®š</span>\n<span class=\"token comment\">## batch_dataè¿”å›çš„å€¼æ ¹æ®def __getitem__(self, index)æ¥ç¡®å®š</span>\n<span class=\"token comment\">## å¯¹è®­ç»ƒé›†ï¼š(ä¸å¤ªæ¸…æ¥šenumerateè¿”å›ä»€ä¹ˆçš„æ—¶å€™å°±å¤šprintè¯•è¯•)</span>\n<span class=\"token keyword\">for</span> i_batch<span class=\"token punctuation\">,</span> batch_data <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>data_loader_train<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>i_batch<span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°batchç¼–å·</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>batch_data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°è¯¥batché‡Œé¢src</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>batch_data<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°è¯¥batché‡Œé¢trg</span>\n<span class=\"token comment\">## å¯¹æµ‹è¯•é›†ï¼šï¼ˆä¸‹é¢çš„è¯­å¥ä¹Ÿå¯ä»¥ï¼‰</span>\n<span class=\"token keyword\">for</span> i_batch<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> trg<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>data_loader_test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>i_batch<span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°batchç¼–å·</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°è¯¥batché‡Œé¢srcçš„å°ºå¯¸</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>trg<span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°è¯¥batché‡Œé¢trgçš„å°ºå¯¸    </span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>\n<p>ç”Ÿæˆçš„data_trainå¯ä»¥é€šè¿‡\n<code>data_train[xxx]</code>ç›´æ¥ç´¢å¼•æŸä¸ªå…ƒç´ ï¼Œæˆ–è€…é€šè¿‡<code>next(iter(data_train))</code>\nå¾—åˆ°ä¸€æ¡æ¡çš„æ•°æ®ã€‚</p>\n<ol start=\"2\" type=\"1\">\n<li>å€ŸåŠ©TensorDatasetå°†æ•°æ®åŒ…è£…æˆdataset</li>\n</ol>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> torch\n<span class=\"token keyword\">from</span> torch <span class=\"token keyword\">import</span> nn\n<span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">import</span> Dataset<span class=\"token punctuation\">,</span> DataLoader<span class=\"token punctuation\">,</span> TensorDataset\n \nsrc <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>sin<span class=\"token punctuation\">(</span>torch<span class=\"token punctuation\">.</span>arange<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ntrg <span class=\"token operator\">=</span> torch<span class=\"token punctuation\">.</span>cos<span class=\"token punctuation\">(</span>torch<span class=\"token punctuation\">.</span>arange<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n \ndata <span class=\"token operator\">=</span> TensorDataset<span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">,</span> trg<span class=\"token punctuation\">)</span>\ndata_loader <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> i_batch<span class=\"token punctuation\">,</span> batch_data <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>data_loader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>i_batch<span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°batchç¼–å·</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>batch_data<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°è¯¥batché‡Œé¢src</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>batch_data<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">## æ‰“å°è¯¥batché‡Œé¢trg</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ol start=\"3\" type=\"1\">\n<li>åœ°å€è¯»å–ï¼Œç”Ÿæˆæ•°æ®çš„è·¯å¾„ txtæ–‡ä»¶</li>\n</ol>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">import</span> Dataset\n<span class=\"token keyword\">from</span> torch<span class=\"token punctuation\">.</span>utils<span class=\"token punctuation\">.</span>data <span class=\"token keyword\">import</span> DataLoader\n<span class=\"token keyword\">import</span> matplotlib<span class=\"token punctuation\">.</span>image <span class=\"token keyword\">as</span> mpimg\n\n\n\n<span class=\"token comment\">## å¯¹æ‰€æœ‰å›¾ç‰‡ç”Ÿæˆpath-label map.txt è¿™ä¸ªç¨‹åºå¯æ ¹æ®å®é™…éœ€è¦é€‚å½“ä¿®æ”¹</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">generate_map</span><span class=\"token punctuation\">(</span>root_dir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token comment\">##å¾—åˆ°å½“å‰ç»å¯¹è·¯å¾„</span>\n    current_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>abspath<span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">##os.path.dirname()å‘å‰é€€ä¸€ä¸ªè·¯å¾„</span>\n    father_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>abspath<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>dirname<span class=\"token punctuation\">(</span>current_path<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>sep <span class=\"token operator\">+</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>root_dir <span class=\"token operator\">+</span> <span class=\"token string\">'map.txt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> wfp<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> idx <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            subdir <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>root_dir<span class=\"token punctuation\">,</span> <span class=\"token string\">'%d/'</span> <span class=\"token operator\">%</span> idx<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">for</span> file_name <span class=\"token keyword\">in</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>subdir<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                abs_name <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>father_path<span class=\"token punctuation\">,</span> subdir<span class=\"token punctuation\">,</span> file_name<span class=\"token punctuation\">)</span>\n                <span class=\"token comment\">## linux_abs_name = abs_name.replace(\"\\\\\", '/')</span>\n                wfp<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token string\">'&#123;file_dir&#125; &#123;label&#125;\\n'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>file_dir<span class=\"token operator\">=</span>linux_abs_name<span class=\"token punctuation\">,</span> label<span class=\"token operator\">=</span>idx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">## å®ç°MyDatasetsç±»</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">MyDatasets</span><span class=\"token punctuation\">(</span>Dataset<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> <span class=\"token builtin\">dir</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\">## è·å–æ•°æ®å­˜æ”¾çš„dir</span>\n        <span class=\"token comment\">## ä¾‹å¦‚d:/images/</span>\n        self<span class=\"token punctuation\">.</span>data_dir <span class=\"token operator\">=</span> <span class=\"token builtin\">dir</span>\n        <span class=\"token comment\">## ç”¨äºå­˜æ”¾(image,label) tupleçš„list,å­˜æ”¾çš„æ•°æ®ä¾‹å¦‚(d:/image/1.png,4)</span>\n        self<span class=\"token punctuation\">.</span>image_target_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token comment\">## ä»dir--labelçš„mapæ–‡ä»¶ä¸­å°†æ‰€æœ‰çš„tupleå¯¹è¯»å–åˆ°image_target_listä¸­</span>\n        <span class=\"token comment\">## map.txtä¸­å…¨éƒ¨å­˜æ”¾çš„æ˜¯d:/.../image_data/1/3.jpg 1 è·¯å¾„æœ€å¥½æ˜¯ç»å¯¹è·¯å¾„</span>\n        <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span><span class=\"token builtin\">dir</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'map.txt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> fp<span class=\"token punctuation\">:</span>\n            content <span class=\"token operator\">=</span> fp<span class=\"token punctuation\">.</span>readlines<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">##s.rstrip()åˆ é™¤å­—ç¬¦ä¸²æœ«å°¾æŒ‡å®šå­—ç¬¦ï¼ˆé»˜è®¤æ˜¯å­—ç¬¦ï¼‰</span>\n            <span class=\"token comment\">## å¾—åˆ° [['d:/.../image_data/1/3.jpg', '1'], ...,]</span>\n            str_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>s<span class=\"token punctuation\">.</span>rstrip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> s <span class=\"token keyword\">in</span> content<span class=\"token punctuation\">]</span>\n            <span class=\"token comment\">## å°†æ‰€æœ‰å›¾ç‰‡çš„dir--labelå¯¹éƒ½æ”¾å…¥åˆ—è¡¨ï¼Œå¦‚æœè¦æ‰§è¡Œå¤šä¸ªepochï¼Œå¯ä»¥åœ¨è¿™é‡Œå¤šå¤åˆ¶å‡ éï¼Œç„¶åç»Ÿä¸€shuffleæ¯”è¾ƒå¥½</span>\n            self<span class=\"token punctuation\">.</span>image_target_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> x <span class=\"token keyword\">in</span> str_list<span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__getitem__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        image_label_pair <span class=\"token operator\">=</span> self<span class=\"token punctuation\">.</span>image_target_list<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n        <span class=\"token comment\">## æŒ‰pathè¯»å–å›¾ç‰‡æ•°æ®ï¼Œå¹¶è½¬æ¢ä¸ºå›¾ç‰‡æ ¼å¼ä¾‹å¦‚[3,32,32]</span>\n        <span class=\"token comment\">## å¯ä»¥ç”¨åˆ«çš„ä»£æ›¿</span>\n        img <span class=\"token operator\">=</span> mpimg<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span>image_label_pair<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> img<span class=\"token punctuation\">,</span> image_label_pair<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__len__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>image_target_list<span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\">## ç”Ÿæˆmap.txt</span>\n    <span class=\"token comment\">## generate_map('train/')</span>\n\n    train_loader <span class=\"token operator\">=</span> DataLoader<span class=\"token punctuation\">(</span>MyDatasets<span class=\"token punctuation\">(</span><span class=\"token string\">'train/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> batch_size<span class=\"token operator\">=</span><span class=\"token number\">128</span><span class=\"token punctuation\">,</span> shuffle<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">for</span> step <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">20000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> idx<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> label<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> <span class=\"token builtin\">enumerate</span><span class=\"token punctuation\">(</span>train_loader<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>label<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h2 id=\"ç½‘ç»œæ­å»ºtrick\">ç½‘ç»œæ­å»ºTrick</h2>\n<h3 id=\"with-torch.no_grad\">with torch.no_grad()</h3>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>å‚è€ƒï¼šhttps://blog.csdn.net/sazass/article/details/116668755</p></blockquote>\n<p>ä½œç”¨ï¼šåœ¨è¯¥æ¨¡å—ä¸‹ï¼Œæ‰€æœ‰è®¡ç®—å¾—å‡ºçš„tensorçš„requires_gradéƒ½è‡ªåŠ¨è®¾ç½®ä¸ºFalseã€‚å½“requires_gradè®¾ç½®ä¸ºFalseæ—¶,åå‘ä¼ æ’­æ—¶å°±ä¸ä¼šè‡ªåŠ¨æ±‚å¯¼äº†ï¼Œå› æ­¤å¤§å¤§èŠ‚çº¦äº†æ˜¾å­˜æˆ–è€…è¯´å†…å­˜ã€‚</p>\n<h2 id=\"åŸºæœ¬åŠŸèƒ½å‡½æ•°\">åŸºæœ¬åŠŸèƒ½å‡½æ•°</h2>\n<h3 id=\"torch.max\">torch.max()</h3>\n<p><code>torch.max(input) â†’ Tensor</code>:è¿”å›è¾“å…¥tensorä¸­æ‰€æœ‰å…ƒç´ çš„æœ€å¤§å€¼</p>\n<p><code>torch.max(input, dim, keepdim=False, out=None) -&gt; (Tensor, LongTensor)</code>:\næŒ‰ç»´åº¦dim è¿”å›æœ€å¤§å€¼ï¼Œå¹¶ä¸”è¿”å›ç´¢å¼•ã€‚</p>\n<pre class=\"line-numbers language-python\" data-language=\"python\"><code class=\"language-python\">torch<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>ï¼Œ åªè¿”å›æœ€å¤§å€¼çš„æ¯ä¸ªæ•°\n\ntroch<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>ï¼Œ åªè¿”å›æœ€å¤§å€¼çš„æ¯ä¸ªç´¢å¼•\n\ntorch<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>data åªè¿”å›variableä¸­çš„æ•°æ®éƒ¨åˆ†ï¼ˆå»æ‰Variable containing<span class=\"token punctuation\">:</span>ï¼‰\n\ntorch<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>numpy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> æŠŠæ•°æ®è½¬åŒ–æˆnumpy ndarry\n\ntorch<span class=\"token punctuation\">.</span><span class=\"token builtin\">max</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>numpy<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>squeeze<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> æŠŠæ•°æ®æ¡ç›®ä¸­ç»´åº¦ä¸º<span class=\"token number\">1</span> çš„åˆ é™¤æ‰<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h1 id=\"python\">python</h1>\n<p><code>str.lower()</code> å…¨éƒ¨è½¬åŒ–ä¸ºå°å†™å­—æ¯</p>\n","feature":true,"text":"pytorch å‚æ•° &amp; å‘½ä»¤è¡Œ &amp; è¾…åŠ© logger loggeræ¨¡å—è§£é‡Š â€”â€” CSDN loggerä½¿ç”¨æ¡ˆä¾‹ loggingæ¨¡å—æ˜¯Pythonå†…ç½®çš„æ ‡å‡†æ¨¡å—ï¼Œä¸»è¦ç”¨äºè¾“å‡ºè¿è¡Œæ—¥å¿—ï¼Œå¯ä»¥è®¾ç½®è¾“å‡ºæ—¥å¿—çš„ç­‰çº§ã€æ—¥å¿—ä¿å­˜è·¯å¾„ã€æ—¥å¿—æ–‡ä»¶å›æ»šç­‰ yacs.config...","link":"","photos":[],"count_time":{"symbolsCount":"7.4k","symbolsTime":"7 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#pytorch\"><span class=\"toc-text\">pytorch</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8F%82%E6%95%B0-%E5%91%BD%E4%BB%A4%E8%A1%8C-%E8%BE%85%E5%8A%A9\"><span class=\"toc-text\">å‚æ•° &amp; å‘½ä»¤è¡Œ &amp; è¾…åŠ©</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#logger\"><span class=\"toc-text\">logger</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#yacs.config\"><span class=\"toc-text\">yacs.config</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AE%BE%E5%A4%87%E7%9B%B8%E5%85%B3\"><span class=\"toc-text\">è®¾å¤‡ç›¸å…³</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#torch.cuda.synchronize\"><span class=\"toc-text\">torch.cuda.synchronize()</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD\"><span class=\"toc-text\">æ•°æ®åŠ è½½</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE%E5%8F%98%E6%8D%A2\"><span class=\"toc-text\">å›¾åƒæ•°æ®å˜æ¢</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#dataloader\"><span class=\"toc-text\">DataLoader</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%BD%91%E7%BB%9C%E6%90%AD%E5%BB%BAtrick\"><span class=\"toc-text\">ç½‘ç»œæ­å»ºTrick</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#with-torch.no_grad\"><span class=\"toc-text\">with torch.no_grad()</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">åŸºæœ¬åŠŸèƒ½å‡½æ•°</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#torch.max\"><span class=\"toc-text\">torch.max()</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#python\"><span class=\"toc-text\">python</span></a></li></ol>","author":{"name":"Star","slug":"blog-author","avatar":"https://gitee.com/zyxstar/Pic_bed/raw/master/image/C06BE6D9-B862-4B4B-A025-F273AE06FAF0.jpeg","link":"/","description":"æœ‰æ£±æœ‰è§’ï¼Œè¿˜ä¼šå‘å…‰ï¼›è®¤çœŸç”Ÿæ´»ï¼Œæ˜Ÿä¹‹ç…Œç…Œ","socials":{"github":"https://github.com/ZYXsmile","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ä¸€ç±»åµŒå…¥çš„åå‘è’¸é¦","uid":"082602022df518a2faf6c62dcd303051","slug":"ä¸€ç±»åµŒå…¥åå‘è’¸é¦","date":"2022-05-04T03:30:00.000Z","updated":"2022-05-04T03:30:26.007Z","comments":true,"path":"api/articles/ä¸€ç±»åµŒå…¥åå‘è’¸é¦.json","keywords":null,"cover":null,"text":"Anomaly Detection via Reverse Distillation from One-Class Embedding é€šè¿‡ä¸€ç±»åµŒå…¥çš„åå‘è’¸é¦è¿›è¡Œå¼‚å¸¸æ£€æµ‹ Abstract Knowledge distillation (KD) achieves promisin...","link":"","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"13 mins."},"categories":[],"tags":[{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","count":2,"path":"api/tags/æ·±åº¦å­¦ä¹ .json"},{"name":"å¼‚å¸¸åˆ†å‰²","slug":"å¼‚å¸¸åˆ†å‰²","count":2,"path":"api/tags/å¼‚å¸¸åˆ†å‰².json"}],"author":{"name":"Star","slug":"blog-author","avatar":"https://gitee.com/zyxstar/Pic_bed/raw/master/image/C06BE6D9-B862-4B4B-A025-F273AE06FAF0.jpeg","link":"/","description":"æœ‰æ£±æœ‰è§’ï¼Œè¿˜ä¼šå‘å…‰ï¼›è®¤çœŸç”Ÿæ´»ï¼Œæ˜Ÿä¹‹ç…Œç…Œ","socials":{"github":"https://github.com/ZYXsmile","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"DMLNet","uid":"cca6975b74b1218e11c5b9ba5de4d5ef","slug":"DMLNet","date":"2022-05-03T12:07:00.000Z","updated":"2022-05-04T06:39:34.572Z","comments":true,"path":"api/articles/DMLNet.json","keywords":null,"cover":[],"text":" å¼€æ”¾ä¸–ç•Œè¯­ä¹‰åˆ†å‰² å¼€é›†è¯­ä¹‰åˆ†å‰²æ¨¡å— é—­é›†è¯­ä¹‰åˆ†å‰²å­æ¨¡å— å¼‚å¸¸åˆ†å‰²å­æ¨¡å— å¢é‡å°æ ·æœ¬å­¦ä¹ æ¨¡å— æˆ‘æ˜¯çŸ­å°ç²¾æ‚çš„æ–‡ç« æ‘˜è¦(à¹‘â€¢Ì€ã…‚â€¢Ì) âœ§ CODE multiscale æ˜¯è‡ªå·±è®¾å®šçš„å— cfg.DATASET.imgSizes = (300, 375, 450, 525, 600) ...","link":"","photos":[],"count_time":{"symbolsCount":"12k","symbolsTime":"11 mins."},"categories":[],"tags":[{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","count":2,"path":"api/tags/æ·±åº¦å­¦ä¹ .json"},{"name":"å¼‚å¸¸åˆ†å‰²","slug":"å¼‚å¸¸åˆ†å‰²","count":2,"path":"api/tags/å¼‚å¸¸åˆ†å‰².json"},{"name":"åº¦é‡å­¦ä¹ ","slug":"åº¦é‡å­¦ä¹ ","count":1,"path":"api/tags/åº¦é‡å­¦ä¹ .json"}],"author":{"name":"Star","slug":"blog-author","avatar":"https://gitee.com/zyxstar/Pic_bed/raw/master/image/C06BE6D9-B862-4B4B-A025-F273AE06FAF0.jpeg","link":"/","description":"æœ‰æ£±æœ‰è§’ï¼Œè¿˜ä¼šå‘å…‰ï¼›è®¤çœŸç”Ÿæ´»ï¼Œæ˜Ÿä¹‹ç…Œç…Œ","socials":{"github":"https://github.com/ZYXsmile","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}